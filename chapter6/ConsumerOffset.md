# 6.1 컨슈머 오프셋 관리


컨슈머의 동작 중 가장 핵심은 바로 오프셋 관리입니다.  
컨슈머는 카프카에 저장된 메시지를 꺼내오는 역할을 하기 때문에 컨슈머가 메시지를 어디까지 가져왔는지를 표시하는 것은 매우 중요합니다.  

예를 들어 코드 배포로 인해 컨슈머가 일시적으로 동작을 멈추고 재시작하는 경우나, 컨슈머가 구동중인 서버에서 문제가 발생해 새로운 컨슈머가 기존 컨슈머의 역할을 대신하는 경우에는 기존 컨슈머의 마지막 메시지 위치부터 새로운 컨슈머가 메시지를 가져올 수 있어야만 장애로부터 빠르게 복구될 수 있습니다.  

카프카에서는 메시지의 위치를 나타내는 위치를 오프셋(offset)이라고 부르는데, 이 오프셋은 숫자 형태로 나타냅니다.  
컨슈머 그룹은 자신의 오프셋 정보를 카프카에서 가장 안전한 저장소인 토픽에 저장합니다.  
즉, __consumer_offsets 토픽에 각 컨슈머 그룹별로 오프셋 위치 정보가 기록됩니다.  

컨슈머들은 지정된 토픽의 메시지를 읽은 뒤, 읽어온 위치의 오프셋 정보를 __consumer_offsets에 기록합니다.  
이때 컨슈머 그룹은 컨슈머 그룹, 토픽, 파티션 등의 내용을 통합해 기록합니다.  

이렇게 __counsumer_offsets 토픽에 기록된 정보를 이용해 컨슈머 그룹은 자신의 그룹이 속해있는 컨슈머의 변경이 발생하는 경우(컨슈머 장애 또는 컨슈머 이탈 등) 해당 컨슈머가 어느 위치까지 읽었는지를 추적할 수 있습니다.  
여기서 저장되는 오프셋값은 컨슈머가 마지막까지 읽은 위치가 아니라 컨슈머가 다음으로 읽어야 할 위치를 말합니다.  





